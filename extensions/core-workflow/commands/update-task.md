# /update-task - タスク状態更新コマンド

作業中のtask.mdを更新する。中断前や節目で実行。

## 引数

```
/update-task [オプション]
```

| オプション | 説明 |
|-----------|------|
| (なし) | 対話的に更新内容を確認 |
| --checkpoint | 現在の状態を記録（中断準備） |
| --complete | タスク完了処理 |

## 実行手順

### 通常更新（引数なし）

1. 現在のtask.mdを読み込み
2. 以下を自動検出・提案:
   - 完了した成功基準（チェックを付ける）
   - 完了した実装計画項目
   - 新たに判明した関連ファイル
3. ユーザー確認後に更新

### --checkpoint（中断準備）

1. 現在のtask.mdを読み込み
2. **「変更ログ」セクションを更新**:
   - `git diff --name-only` で変更ファイルを自動検出
   - 各ファイルの変更内容を簡潔に記録（関数名・行番号レベル）
   - 変更の理由を記録
3. **「意思決定記録」セクションを更新**:
   - セッション中にユーザーと合意した設計判断を記録
   - 検討した選択肢と、選んだ理由を記録
   - 却下した案がある場合、その理由も記録（先祖返り防止）
4. 「中断時の状態」セクションを更新:
   - 最後に完了した作業
   - **次に実行すべき作業（ファイル名+関数名レベルで具体化）**
     - 例: ✕「APIを修正する」→ ○「`backend/routers/config.py` の `get_config()` にキャッシュ引数を追加」
   - 未解決の問題・疑問
5. 「進捗メモ」に現在時刻のエントリを追加
6. 最終更新日時を更新

### --complete（タスク完了）

1. 全ての成功基準をチェック確認
2. ステータスを `completed` に変更
3. 「学んだこと・知見」セクションを更新
4. **スキル横展開チェック**を実行（CLAUDE.mdルール）
5. 完了メッセージ表示

## 自動更新項目

| 項目 | タイミング |
|------|-----------|
| 最終更新日時 | 毎回 |
| 進捗メモ | --checkpoint時 |
| 成功基準チェック | 完了検出時 |
| 関連ファイル | 新規ファイル操作時 |

## 出力フォーマット

```
## task.md 更新完了

**更新内容:**
- [x] 成功基準1 を完了としてマーク
- 関連ファイルに `new_file.py` を追加
- 進捗メモを追記

**現在のステータス**: in_progress
**完了率**: 60% (3/5 基準達成)

---
作業を継続しますか？
```

## 注意事項

- task.mdが存在しない場合は `/launch-task` を案内
- 大きな変更はユーザー確認必須
- --complete 時はスキル横展開を忘れずに実行
