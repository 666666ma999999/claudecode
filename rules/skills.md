# スキルシステム運用ルール

## 自動認識
- スキルは `~/.claude/skills/` に配置すれば自動認識される
- CLAUDE.mdへのスキル参照追加は**不要**

## スキル作成時の禁止事項
- CLAUDE.mdにスキルのトリガーや説明を追加しない
- スキルの内容をCLAUDE.mdに複製しない

## スキル配置場所

### グローバルスキル（全プロジェクト共通）
```
~/.claude/skills/<スキル名>/
├── SKILL.md
├── scripts/
├── references/
└── assets/
```

### プロジェクトスキル（特定プロジェクト専用）
```
<project-root>/.claude/skills/<スキル名>/
├── SKILL.md
├── scripts/
├── references/
└── assets/
```

### 配置先の判断基準

| 条件 | 配置先 |
|------|--------|
| 複数プロジェクトで使う汎用パターン | `~/.claude/skills/`（グローバル） |
| 特定プロジェクトの固有ワークフロー | `project/.claude/skills/`（プロジェクト） |
| 特定CMS・外部システムの操作手順 | `project/.claude/skills/`（プロジェクト） |
| 言語・フレームワーク共通のパターン | `~/.claude/skills/`（グローバル） |

### プロジェクトスキルの利点
- **トークン節約**: 他プロジェクト作業時に読み込まれない
- **移植性**: `git clone` でスキルも一緒に来る
- **分離**: プロジェクト固有の知識が他を汚染しない

## スキル改善ルール
- スキル使用後、新しいパターンやエラー対処法が見つかった場合、該当スキルのSKILL.mdまたはreferencesに追記すること
- ユーザーへの確認なしで自動実行

## スキル化判断フロー（実装完了時に毎回実行）

以下の質問に順番に回答して判断：

```
Q0. このスキルは特定プロジェクト専用か？
    → YES → プロジェクトスキルとして `project/.claude/skills/` に配置
    → NO（複数プロジェクトで使う）→ グローバルスキルとして `~/.claude/skills/` に配置
    → 判断後、Q1へ進む

Q1. 今回の変更は以下のいずれかに該当するか？
    - 新機能追加
    - 新しいパターンの発見
    - バグ修正で「定数値の誤り」「インデックスずれ」「キー名不整合」等の再発しうる問題
    - 既存スキルに記載された情報の誤り（コード修正でスキルの記載が古くなった場合）
    → NO → 終了
    → YES → Q2へ

Q2. この知見は今後も繰り返し使うか？または既存スキルの情報更新が必要か？
    → NO → 終了
    → YES → Q3へ

Q3. 既存スキルに追加・修正可能か？（~/.claude/skills/ を確認）
    → YES → 該当スキルに追記・修正（自動実行・確認不要）→ 終了
    → NO → ユーザーに確認「新規スキルを作成しますか？」
```

**重要: コード修正が既存スキルに記載されたインデックス・定数・手順に影響する場合、スキルも同時に更新すること。コードとスキルの不整合は禁止。**

## 修正完了後の自動振り返り（必須）

**スキル修正・機能追加・エラー解決後、以下を自動で判断・実行すること:**

### 1. 汎用知見の横展開チェック

```
確認項目:
- このパターンは他のシステム/サイトでも使えるか？
- 同様のエラーが他のスキルでも発生しうるか？
- 共通のトラブルシューティングとして追加すべきか？
```

**該当する場合**: 関連スキルにも追記（ユーザー確認不要）

### 2. スキル構成の最適化判断

| 状況 | 判断 |
|------|------|
| 特定システム専用の知見 | 既存スキルに追加 |
| 複数システムで共通の知見 | 汎用スキル作成を検討 |
| 既存の汎用スキルに該当 | そのスキルに追加 |

### 3. 自動実行の範囲

以下は**ユーザー確認なしで自動実行**:
- 既存スキルへの知見追記
- トラブルシューティングの追加
- セレクタ・URL等の更新

以下は**ユーザーに確認**:
- 新規スキルの作成
- スキルの統合・削除
- 大規模な構造変更

## スキル作成時の重複チェック（必須）

**新規スキル作成前に必ず以下を実行すること:**

```bash
# グローバルスキル確認
ls ~/.claude/skills/
ls ~/.claude/skills/ | grep -i <キーワード>
grep -r "<機能キーワード>" ~/.claude/skills/*/SKILL.md

# プロジェクトスキル確認
ls .claude/skills/ 2>/dev/null
grep -r "<機能キーワード>" .claude/skills/*/SKILL.md 2>/dev/null
```

### 重複発見時の対応

| 状況 | 対応 |
|------|------|
| 完全重複 | 新規作成せず既存スキルを使用 |
| 部分重複 | 既存スキルに機能追加 |
| 類似機能で別目的 | 既存スキルからの参照を検討 |

### 命名規則

- **STEPシリーズ**: `step{番号}-{機能名}` 形式で統一
- **汎用スキル**: 機能を表す名前（kebab-case）

### 禁止事項

- 同じ機能に異なる名前のスキルを作成しない
- 既存スキルの存在を確認せずに新規作成しない
