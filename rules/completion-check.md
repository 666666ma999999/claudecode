# 実装完了時の必須チェック（最優先）

**コード修正・機能追加が完了したら、完了報告の前に以下を順番に実行：**

## STEP 1: サーバー再起動（該当する場合）

対象ファイルを編集した場合のみ：
- backend/main.py、フロントエンドファイル、設定ファイル

```
1. ./stop_servers.sh → ./start_unified_server.sh
2. curl -s -o /dev/null -w "%{http_code}" http://localhost:5558/ で 200 確認
3. 動作確認
```

## STEP 2: Codexレビュー（必須）

- `mcp__codex__codex`を使用してコード変更をレビューする
- `/review`コマンドと同等の処理を自動実行する
- **指摘事項は全て修正してから次へ進む（今回の変更に起因するかどうかを問わない）**
- 「既存バグだから対象外」という判断は禁止。Codexが検出した不具合は全て即時修正する
- 修正後は再度STEP 1（サーバー再起動・ヘルスチェック）に戻る

## STEP 3: スキル化判断（必須・毎回実行）

以下の質問に順番に回答して判断：

```
Q1. 今回の変更は以下のいずれかに該当するか？
    - 新機能追加
    - 新しいパターンの発見
    - バグ修正で「定数値の誤り」「インデックスずれ」「キー名不整合」等の再発しうる問題
    - 既存スキルに記載された情報の誤り（コード修正でスキルの記載が古くなった場合）
    → NO → STEP 4へ
    → YES → Q2へ

Q2. この知見は今後も繰り返し使うか？または既存スキルの情報更新が必要か？
    → NO → STEP 4へ
    → YES → Q3へ

Q3. 既存スキルに追加・修正可能か？（~/.claude/skills/ を確認）
    → YES → 該当スキルに追記・修正（自動実行・確認不要）→ STEP 4へ
    → NO → ユーザーに確認「新規スキルを作成しますか？」
```

**重要: コード修正が既存スキルに記載されたインデックス・定数・手順に影響する場合、スキルも同時に更新すること。コードとスキルの不整合は禁止。**

## STEP 4: 完了報告

上記を全て実施後にユーザーへ報告

---

## サーバー再起動ルール（詳細）

- **backend/main.py** を編集した場合
- **フロントエンドファイル** を編集した場合
- **設定ファイル** を編集した場合

**必須手順:**
1. 修正完了
2. **即座にサーバー再起動** (`./stop_servers.sh` → `./start_unified_server.sh`)
3. **ヘルスチェック必須**: `curl -s -o /dev/null -w "%{http_code}" http://localhost:5558/` で `200` を確認
4. 動作確認・テスト
5. **スキル化判断**（上記STEP 2を実行）
6. 完了報告

## 例外なく実行すること
- 修正直後の再起動は**省略不可**
- 「後でまとめて再起動」は**禁止**
- **ヘルスチェックで200確認前に完了報告禁止**
- **スキル化判断をスキップしない**
- 修正→再起動→ヘルスチェック→テスト→スキル化判断を**1セット**として扱う
- **ユーザーへの確認なしで自動実行**すること（再起動の許可を求めない）
