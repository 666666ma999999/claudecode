# 品質管理・運用ルール

## 1. 事実確認ルール（最優先）

「〜しているか？」「〜の状態は？」「〜が設定されているか？」など、現状の事実に関する質問には、**必ずツールで実態を確認してから回答すること**。

### 禁止事項

- 推測・一般論での回答
- 「通常は〜」「デフォルトでは〜」という前提での回答
- ツール実行なしでの断定

### 必須手順

1. 質問を受けたら、まず関連ファイル・設定・状態をツールで確認
2. 確認結果に基づいて回答
3. 確認できなかった場合は「未確認」と明示

### 確認すべき対象例

| 質問の種類 | 確認方法 |
|-----------|---------|
| git設定 | `git remote -v`, `git log`, `git status` |
| ファイル存在 | `ls`, `Glob` |
| 設定内容 | `Read`でファイル読み込み |
| プロセス状態 | `ps`, `curl` |
| hook/自動化 | 設定ファイルとスクリプトを`Read` |

---

## 2. エラー報告フォーマット

エラーが発生した場合、以下の構造で報告すること：

### 0. Sentry Issue URL（任意）
- Sentryで該当issueがある場合はURLを記載: `https://sentry.io/organizations/.../issues/.../`
- Sentry未使用の場合はスキップ

### 1. 症状（何が起きたか）
- エラーメッセージの正確な引用
- スクリーンショットがあれば提示

### 2. 原因（なぜ起きたか）
- コードの流れを追跡し、根本原因を特定
- 該当ファイル名と行番号を明記
- データの変遷を示す（入力 → 変換 → 出力）

### 3. 経緯（なぜこの状態になったか）
- 過去の変更履歴との関係
- スキルドキュメントとの不整合があれば指摘

### 4. 選択肢（どう直すか）
- 複数の修正方針を提示（最低2つ）
- 各選択肢のトレードオフを明記
- 影響範囲を示す

### 適用場面

- ブラウザ自動化のエラー
- API呼び出しの失敗
- データ不整合
- テスト失敗
- スキルドキュメントと実際のコードの乖離

---

## 3. メモリシステム棲み分けルール

### 2つのメモリシステム

| システム | 目的 | 記録対象 |
|---|---|---|
| **Claude-Mem**（プラグイン） | 「何をしたか」の活動記録 | ツール使用・セッション活動を自動観測 |
| **Memory MCP** | 「何を知っているか」の知識蓄積 | エンティティ・リレーション・決定事項 |

### 使い分け基準

**Claude-Mem に任せるもの（自動記録）:**
- セッション中のツール使用履歴
- ファイル変更の時系列記録
- 作業の進捗状況

**Memory MCP に記録するもの（意図的に保存）:**
- プロジェクト間で共通の設計判断・方針決定
- ユーザーの好み・ワークスタイル
- 繰り返し参照する技術的知見
- エンティティ間の関係（「プロジェクトAはライブラリBに依存」等）

### 記録タイミング

**Memory MCP への保存トリガー:**
- ユーザーが「覚えておいて」「記録して」と明示した場合
- 新しいプロジェクト固有の方針が決まった場合
- トラブルシューティングで再利用可能な知見を得た場合

**記録しないもの:**
- 一時的な作業状態（Claude-Memが自動記録）
- SKILL.mdやルールファイルに既に記載されている情報（重複禁止）
- 機密情報（APIキー、パスワード等）

### 既存システムとの関係

| 既存システム | 役割 | Memory MCPとの関係 |
|---|---|---|
| SKILL.md | 再利用可能な手順・パターン | スキルに書けないメタ知識をMemoryに保存 |
| rules/*.md | 行動ルール・制約 | ルールに書けない暗黙知をMemoryに保存 |
| task.md | 現在のタスク状態 | タスク完了時の学びをMemoryに保存 |
| Claude-Mem | 活動履歴 | 活動の「意味」をMemoryに保存 |
