# /review - Codexコードレビューコマンド

変更内容をCodexでレビューし、品質フィードバックを取得する。

## 引数

```
/review [オプション]
```

| オプション | 説明 |
|-----------|------|
| (なし) | git diff でステージング済み + 未ステージの変更をレビュー |
| --staged | ステージング済みの変更のみレビュー |
| --file PATH | 特定ファイルのみレビュー |
| --last-commit | 直前のコミットをレビュー |

## 実行手順

### 1. 変更内容の取得

```bash
# デフォルト: 全変更
git diff HEAD

# --staged: ステージング済みのみ
git diff --cached

# --last-commit: 直前のコミット
git show HEAD

# --file: 特定ファイル
git diff HEAD -- {PATH}
```

### 2. task.mdの確認（存在する場合）

task.mdがあれば、以下を取得してコンテキストに含める:
- タスクの目的・背景
- 成功基準

### 3. Codexにレビュー依頼

`mcp__codex__codex` ツールを使用して以下をレビュー:

```
レビュー観点:
1. **バグ・エラー**: 明らかなバグ、エッジケース漏れ
2. **セキュリティ**: 脆弱性、機密情報の露出
3. **パフォーマンス**: 非効率なコード、N+1問題
4. **可読性**: 命名、コメント、構造
5. **テスト**: テストカバレッジ、テストケース漏れ
6. **設計**: SOLID原則、DRY違反
```

### 4. レビュー結果の表示

```markdown
## Codex Review Result

### Critical Issues (修正必須)
- [ ] Issue 1: 説明
- [ ] Issue 2: 説明

### Warnings (検討推奨)
- [ ] Warning 1: 説明

### Suggestions (任意改善)
- Suggestion 1: 説明

### Good Points (良い点)
- Good 1: 説明

---
全体評価: ⭐⭐⭐⭐☆ (4/5)
```

## Codexプロンプトテンプレート

```
以下のコード変更をレビューしてください。

## コンテキスト
タスク: {task.mdの目的 or "不明"}
成功基準: {task.mdの成功基準 or "不明"}

## 変更内容
{git diff出力}

## レビュー観点
1. バグ・エラー: 明らかなバグ、エッジケース漏れはないか
2. セキュリティ: 脆弱性、機密情報の露出はないか
3. パフォーマンス: 非効率なコード、N+1問題はないか
4. 可読性: 命名、コメント、構造は適切か
5. テスト: テストカバレッジは十分か
6. 設計: SOLID原則、DRY原則に違反していないか

## 出力形式
Critical Issues、Warnings、Suggestions、Good Pointsに分類して報告してください。
```

## 注意事項

- 変更がない場合は「レビュー対象なし」と報告
- 大量の変更（500行超）は要約モードで実行
- Codexのレスポンスをそのまま表示（加工しない）
- レビュー結果はtask.mdに追記しない（別途判断）

## 使用例

```bash
# 全変更をレビュー
/review

# ステージング済みのみ
/review --staged

# 特定ファイル
/review --file src/api/handler.py

# 直前のコミット
/review --last-commit
```
