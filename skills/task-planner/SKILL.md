---
name: task-planner
description: ざっくりした要望を具体的なファイル単位タスクに分解し、実装計画を策定するスキル
---

# タスク細分化・実装計画策定スキル

## トリガー条件

以下のようなざっくりした要望を受けた時に自動発動:
- 「〜機能が欲しい」「〜を追加して」「〜できるようにして」
- 「〜を改善して」「〜をリファクタリングして」
- 複数ファイルにまたがる変更が予想される要望全般

## ワークフロー

### Phase 1: 要件整理

`AskUserQuestion`で曖昧な点を具体化する。確認すべき項目:

- **対象範囲**: どの画面・機能に影響するか
- **ユーザー操作**: どういう操作で何が起きるべきか
- **エッジケース**: エラー時・データなし時の挙動
- **優先度**: 必須機能 vs あれば嬉しい機能

### Phase 2: 既存コード調査

`Task(subagent_type=Explore)`で以下を調査:

1. **類似機能の既存実装**: 同じパターンが既にないか
2. **拡張ポイント**: 既存コードのどこを拡張すれば実現できるか
3. **依存関係**: 変更が影響する他のファイル・関数
4. **再利用可能な関数・パターン**: development.mdの実装前チェックリストに従い検索

### Phase 3: タスク分解

ファイル単位の修正タスクに分解する。各タスクには以下を含める:

- **対象ファイル**: 修正するファイルパス
- **変更内容**: 何を追加・修正するか（関数名・セクション名レベル）
- **依存タスク**: このタスクの前に完了すべきタスク番号

分解の粒度:
- 1タスク = 1ファイルの1つの論理的変更
- テストは実装タスクとセットにする

### Phase 4: 依存関係整理

実行順序を以下の優先度で決定:

1. **データモデル・型定義** (models.py等)
2. **バックエンドAPI** (routers/, services/)
3. **フロントエンドUI** (HTML, JS, CSS)
4. **設定・定数** (config等)
5. **テスト・検証**

### Phase 5: task.mdに出力

`.claude/workspace/task.md`に以下の形式で書き出す:

```markdown
# タスク: [要望の要約]

## メタ情報
- ステータス: 計画中
- 作成日時: YYYY-MM-DD HH:MM

## 成功基準
- [ ] 基準1
- [ ] 基準2

## 実装計画

### Phase 1: [フェーズ名]
- [ ] T1: [タスク名] | `対象ファイル` | 依存: なし | [概要]
- [ ] T2: [タスク名] | `対象ファイル` | 依存: T1 | [概要]

### Phase 2: [フェーズ名]
- [ ] T3: [タスク名] | `対象ファイル` | 依存: T1,T2 | [概要]

## 中断時の状態
- 次のアクション: Phase 1から開始
- 未解決問題: なし
```

## 注意事項

- 新規ファイル作成は最終手段。既存ファイル拡張を優先（development.md準拠）
- APIレスポンスはCamelCaseModel使用（naming.md準拠）
- 計画策定後、`AskUserQuestion`でユーザーに方向性を確認してから実装開始
