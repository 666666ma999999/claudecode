---
name: web-data-downloader
description: Webサイトから確定申告用データを自動取得するスキル。ふるさと納税サイト（ふるなび等）の寄付履歴、クレジットカード会社（アメックス等）の利用明細PDF、その他Webサイトからのデータ取得を自動化。Playwrightブラウザ操作でログイン後のページからデータをダウンロード・スクリーンショット保存。「サイトからデータをダウンロード」「明細PDFを取得」「寄付履歴を保存」などのリクエストで使用。
---

# Web Data Downloader

確定申告やデータ収集のためにWebサイトからデータを自動取得するスキル。

## ワークフロー

### 1. 事前確認

ユーザーに以下を確認:
- 対象サイト名
- 取得期間（例: 202501-202512）
- 取得するデータ種類（PDF、CSV、スクリーンショット等）
- 保存先（デフォルト: デスクトップ）

### 2. サイトごとの処理フロー

```
サイトにアクセス
    ↓
ログインページへ移動
    ↓
ユーザーに「ログインしてください」と依頼
    ↓
ユーザーの「ログインしました」を待つ
    ↓
対象ページへ移動（履歴、明細等）
    ↓
期間・年度を選択
    ↓
データ取得（ダウンロード or スクリーンショット）
    ↓
指定フォルダにコピー
```

### 3. データ取得方法

**PDFダウンロード**（アメックス等）:
1. 明細一覧ページで各ダウンロードボタンをクリック
2. ファイル形式選択ダイアログでPDFを選択して確定
3. `.playwright-mcp/`に保存後、指定フォルダにコピー

**スクリーンショット**（ふるなび等）:
1. 対象ページでfullPageスクリーンショットを取得
2. `.playwright-mcp/`に保存後、指定フォルダにコピー

## サイト別設定

### ふるなび
- URL: https://furunavi.jp/
- ログインURL: https://furunavi.jp/login.aspx
- 取得データ: 寄附受付履歴（スクリーンショット）
- 手順: マイページ → 寄附受付履歴 → 年度選択 → スクリーンショット

### アメリカン・エキスプレス
- URL: https://www.americanexpress.com/ja-jp/
- ログインURL: https://www.americanexpress.com/ja-jp/account/login
- 取得データ: ご利用代金明細書（PDF）
- 手順: ご利用状況 → ご利用代金明細書（PDF他） → 各月のダウンロードボタン → PDF選択 → ダウンロード

## 注意事項

- Playwrightのダウンロード先は`.playwright-mcp/`固定。取得後にBashでコピー
- ログインはユーザーに依頼（認証情報は扱わない）
- ダイアログ表示時は適切なボタンをクリック
- 大量ダウンロード時は各ファイル間で1-2秒待機

## bot検知でサイトにアクセスできない場合

サイトがPlaywrightを検知してアクセスをブロックする場合は、**CDP接続方式**を使用:

**→ `playwright-browser-automation` スキルの「リモートChrome接続（CDP）によるbot検知回避」を参照**

概要:
1. 通常のChromeをデバッグモード(`--remote-debugging-port=9222`)で起動
2. そのChromeで手動でサイトにログイン
3. Playwrightから`connect_over_cdp()`で接続してCookieを取得
4. 取得したCookieを使って自動化

## 出力形式

完了時は以下を報告:
- 取得したファイル一覧（ファイル名、サイズ）
- 保存先パス
- 取得データのサマリー（例: 寄付合計金額、明細件数）
