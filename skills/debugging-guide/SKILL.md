# デバッグ4段階根本原因分析ガイド

キーワード: デバッグ, 根本原因分析, 4段階, バグ調査, debugging

## 鉄則

**根本原因を特定するまで修正に着手しない。症状への対症療法は失敗である。**

## 適用場面

テスト失敗、本番バグ、予期しない挙動、パフォーマンス問題、ビルドエラー、統合エラーなど、あらゆる技術的問題に適用する。特に以下の状況では本手順の遵守が重要:
- 時間的プレッシャーがある時
- 修正が「明らか」に見える時
- 複数回の修正が失敗した後

## 4段階根本原因分析

### Phase 1: 根本原因の調査

1. エラーメッセージを**最後まで完全に**読む（警告・スタックトレースを飛ばさない）
2. 再現手順を確立し、**一貫して再現できる**ことを確認する
3. `git log`・`git diff`で直近の変更を確認する
4. 複数コンポーネントにまたがるシステムでは、境界ごとに診断ログを追加して障害箇所を特定する
5. コールスタックを**逆方向**にデータフローを追跡する

### Phase 2: パターン分析

1. 同一コードベース内の**正常に動作する類似コード**を見つける
2. リファレンス実装を**完全に**読む
3. 動作するコードと壊れたコードの**全ての差分**をリスト化する
4. 依存関係と暗黙の前提条件を文書化する

### Phase 3: 仮説と検証

1. 具体的な仮説を述べる: 「Xが根本原因である。なぜならY」
2. **一度に一つの変数のみ**を変更して最小限のテストを行う
3. 結果を検証してから次に進む
4. 理解に穴がある場合は推測せず**認める**

### Phase 4: 実装

1. まず**失敗するテストケース**を作成する
2. 根本原因に対処する**単一の修正**を実装する
3. 修正が問題を解決し、他のテストを壊していないことを検証する
4. **3回の修正が失敗したら停止**し、アーキテクチャレベルの見直しを行う（3-Fix Limitルール）
