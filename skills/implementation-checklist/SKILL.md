---
name: implementation-checklist
description: |
  コード修正・機能追加完了後の必須チェックリスト。サーバー再起動、Codexレビュー（2段階）、Sentryチェック、テスト同期確認、スキル化判断、セッション記録、完了報告のSTEP 1-4を順番に実行する。
  実装完了時・コードレビュー時・`/verify-step`コマンド実行時に自動発動。
  キーワード: 実装完了, チェックリスト, Codexレビュー, スキル化判断, STEP完了
metadata:
  author: masaaki-nagasawa
  version: 1.0.0
---

# 実装完了チェックリスト

コード修正・機能追加が完了したら、完了報告の前に以下を全て実行する。

## STEP 1: サーバー再起動（該当する場合）

backend/main.py・フロントエンド・設定ファイルを編集した場合のみ実行。**確認なしで自動実行**。

```
1. プロジェクトのサーバー再起動スクリプトを実行
2. ヘルスチェックエンドポイントで正常応答を確認
3. 動作確認
```

**強制ルール**:
- 修正直後の再起動は省略不可。「後でまとめて」は禁止
- ヘルスチェックで200確認前に完了報告禁止
- テスト実行中にエラー → 即停止しブラウザ維持してユーザーに報告（自動修正・自動リトライ禁止）

## STEP 2: Codexレビュー（必須・2段階）

**Stage 1: 仕様準拠レビュー**
- `mcp__codex__codex`で変更が要件・仕様を満たしているかレビュー
- task.mdの成功基準との整合性確認
- 指示に含める: 「変更内容がタスクの要件・成功基準を満たしているか検証せよ。入出力の仕様、エッジケースの処理、期待される動作との乖離を検出せよ。」
- **指摘事項は全て修正してからStage 2へ**

**Stage 2: コード品質レビュー**
- `mcp__codex__codex`でコード品質をレビュー
- **指摘は全て修正**（既存バグも対象外にしない）
- 修正後はSTEP 1に戻る

**パラメータチェーン検証**（パラメータ追加・変更時は必須）:
1. 追加パラメータの定義箇所（関数シグネチャ）を特定
2. 呼び出す全箇所をGrepで検索
3. 各呼び出し箇所でパラメータが実際に渡されているか確認
4. 値の出所（`self.xxx`、引数、定数）が正しいか確認
- Codex指示に含める: 「追加・変更されたパラメータについて、定義→dispatcher→実メソッドの全チェーンで値が正しく伝搬しているか検証せよ。Optionalパラメータでデフォルト値に隠れて未接続になっているケースを重点検出せよ。」

### STEP 2.3: Sentryリグレッションチェック（任意）

Sentry MCP有効時のみ: `list_issues`で新規エラー確認 → 検出時は即修正

### STEP 2.5: テストコード同期確認（該当する場合）

- `自動テストコード`のセレクタ・待機条件が修正内容と整合しているか確認
- 不整合発見時は即修正

## STEP 3: スキル化判断（必須・毎回実行・スキップ厳禁）

`~/.claude/rules/skill-lifecycle.md`の「スキル化判断フロー」に従って判断・実行。

**チェックリスト（全て実行すること）**:
1. プロジェクトスキル検索: `project/.claude/skills/` 配下で関連キーワードをGrep
2. グローバルスキル検索: `~/.claude/skills/` 配下で関連キーワードをGrep
3. 該当スキルあり → 内容を読み、今回の変更で更新が必要か判断 → 必要なら更新
4. 該当スキルなし → Q1-Q3フローで新規スキル化を判断

**注意**: STEP 2（Codexレビュー）→ バージョン更新と流れるとSTEP 3をスキップしがち。STEP 2完了後に必ずSTEP 3を実行してからSTEP 4へ進むこと。

### STEP 3.5: セッション記録（30分以上の作業完了時）

教訓・知見の書き込み先スコープ判定:

| 知見の性質 | 書き込み先 |
|-----------|-----------|
| 全プロジェクト共通のワークフロー教訓 | `~/.claude/rules/` の該当ファイル |
| 全プロジェクト共通の技術パターン | `~/.claude/skills/` の該当スキル |
| 特定プロジェクト固有の知見 | プロジェクトMEMORY.md |

**判定基準**: 「この教訓は別プロジェクトでも同じか？」→ YES → グローバル環境。

## STEP 4: 完了報告

上記を全て実施後にユーザーへ報告。
