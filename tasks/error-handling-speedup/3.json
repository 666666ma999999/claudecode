{
  "id": "3",
  "subject": "main.py: B1(タイムアウト最小値) + B2(ログ重複削減) + C2(空パース遮断)",
  "description": "backend/main.pyに3つの改善を実装:\n\n**B1: バッチタイムアウト最小値 (L728付近)**\n75→90秒に変更。3コード×10小見出しで75秒タイムアウトが発生していたため。\n```python\nreturn max(90, min(1800, round(calculated_timeout)))  # 最小90秒\n```\n\n**B2: ログ重複削減 (L395-420付近)**\nモジュールレベルsetで `(sheet_name, code, column)` を記録し、同じ組合せの2回目以降はログスキップ。\n```python\n_cleaned_log_keys: set = set()  # 関数定義の直前に追加\n\n# clean_oversized_text_fields()内のログ出力箇所を変更\nlog_key = (sheet_name, str(code_value), column)\nif log_key not in _cleaned_log_keys:\n    _cleaned_log_keys.add(log_key)\n    logger.info(f\"[{sheet_name}] コード{code_value} カラム'{column}': ...\")\n```\n\n**C2: 空パース連鎖遮断 (L2235, L2331付近)**\nタイムアウト時のログレベル変更 + バッチ全失敗時のログ記録スキップ。\n```python\n# exceptブロック: タイムアウト判定\nis_timeout = \"timeout\" in str(batch_error).lower() or \"Timeout\" in type(batch_error).__name__\nif is_timeout:\n    logger.warning(f\"バッチ処理タイムアウト: {batch_error} - 全コードを個別処理へ\")\nelse:\n    logger.error(f\"バッチ処理で例外発生: {batch_error} - 全コードを個別処理へ\")\n\n# record_batch_manuscript_logs呼び出しにガード追加\nif final_results:\n    await record_batch_manuscript_logs(...)\n```",
  "activeForm": "Implementing main.py changes",
  "status": "in_progress",
  "blocks": [],
  "blockedBy": [],
  "owner": "worker-main"
}