{
  "name": "img-quality-boost",
  "description": "4コマ画像生成の精度向上。prompt-writer, ref-curator, generator, evaluatorの4エージェントで3ラウンド反復改善を実行",
  "createdAt": 1771422808398,
  "leadAgentId": "team-lead@img-quality-boost",
  "leadSessionId": "2724416c-0c87-4b04-afd2-98bdbd34325b",
  "members": [
    {
      "agentId": "team-lead@img-quality-boost",
      "name": "team-lead",
      "agentType": "orchestrator",
      "model": "claude-opus-4-6",
      "joinedAt": 1771422808398,
      "tmuxPaneId": "",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": []
    },
    {
      "agentId": "prompt-writer@img-quality-boost",
      "name": "prompt-writer",
      "agentType": "general-purpose",
      "model": "claude-opus-4-6",
      "prompt": "あなたは画像生成プロンプトの最適化エキスパートです。Gemini Image Generation用のプロンプトを最適化してください。\n\n## コンテキスト\n\n4コマ漫画形式の画像を生成しています。テーマは「出雲の占い師と赤い糸の運命」。\n現在のプロンプトはキーワード列挙型で、Geminiの能力を十分に活かせていません。\n物語的な記述型に変換し、各コマ3バリエーションの合計12プロンプトを作成してください。\n\n## 4コマの構成\n\n**コマA: 神社・占い師の祈り**\n現在: \"A mystical Japanese fortune teller woman praying at Izumo Grand Shrine (出雲大社). She stands before the massive shimenawa (sacred rope) of the shrine, her eyes closed in deep spiritual concentration. She radiates a warm, divine golden aura...\"\n\n**コマB: 手と赤い糸の分岐**\n現在: \"A close-up of a woman's elegant hand, ring finger extended, from which a single glowing red thread of fate (運命の赤い糸) emerges. The red thread begins to multiply and branch out into dozens of luminous threads...\"\n\n**コマC: 宇宙的な赤い糸の拡散**\n現在: \"An abstract mystical scene of countless glowing red threads of fate spreading across a cosmic void. The threads multiply exponentially, creating an intricate web of destiny that fills the entire frame...\"\n\n**コマD: 縁結びの収束**\n現在: \"A close-up of a person's hand (the destined partner), ring finger extended, as multiple glowing red threads of fate converge and gently wrap around the finger. The threads arrive from multiple directions...\"\n\n## Geminiプロンプト最適化ベストプラクティス\n\n1. **写真用語の活用**: レンズタイプ（35mm, 50mm, 85mm, 135mm）、絞り値（f/1.4, f/2.0, f/4.0）、照明設定（Rembrandt lighting, split lighting, rim lighting, three-point lighting）\n2. **明示的な空間関係**: 前景（foreground）、中景（midground）、背景（background）を明確に配置\n3. **素材・テクスチャの具体的記述**: \"silky\", \"rough-hewn cedar\", \"translucent gossamer\", \"liquid gold\" など\n4. **アクション動詞**: \"radiates\", \"cascades\", \"weaves\", \"converges\" など動的な記述\n5. **色パレット**: 各コマの統一カラースキーム（deep indigo, sacred gold, crimson, purple）\n\n## 各コマの3バリエーション指針\n\n- **V1**: ドラマチック・シネマティック（映画的な構図、強い明暗差）\n- **V2**: 繊細・親密（クローズアップ、柔らかい光、感情的）\n- **V3**: 壮大・神秘的（広角、壮大なスケール、超自然的要素強調）\n\n## 出力指示\n\n12個のプロンプトを作成し、それぞれをAPIに登録してください。\n\n**API情報:**\n- Endpoint: POST http://localhost:5560/api/prompts\n- Header: x-api-token: makeimg_dev_token\n- Content-Type: application/json\n- Body例:\n```json\n{\n  \"name\": \"komaA_v1_dramatic\",\n  \"prompt_text\": \"In the sacred inner sanctum of Izumo Grand Shrine...\",\n  \"category\": \"koma_a\",\n  \"tags\": \"round1,narrative,dramatic,v1\"\n}\n```\n\n**命名規則:**\n- name: `koma{A-D}_v{1-3}_{style}`\n- category: `koma_a`, `koma_b`, `koma_c`, `koma_d`\n- tags: `round1,narrative,{style},v{n}`\n\n各プロンプトは最低150語以上の物語的記述にすること。プランに記載されたコマAの改善例を参考にしてください。\n\n完了後、登録した全プロンプトのIDと名前をリーダーに報告してください。",
      "color": "blue",
      "planModeRequired": false,
      "joinedAt": 1771422902430,
      "tmuxPaneId": "in-process",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": [],
      "backendType": "in-process"
    },
    {
      "agentId": "ref-curator@img-quality-boost",
      "name": "ref-curator",
      "agentType": "general-purpose",
      "model": "claude-opus-4-6",
      "prompt": "あなたはリファレンス画像キュレーションの専門家です。4コマ漫画の各コマに最適なリファレンス画像セットを選定してください。\n\n## コンテキスト\n\n「出雲の占い師と赤い糸の運命」テーマの4コマ画像を生成しています。\n現在は全コマで同一リファレンスセット（ID: 84,85,131,133,137,138,140,141,143,144）を使用しており、コマごとの最適化ができていません。\n\n## 既存リファレンス画像一覧\n\n**fortune_teller カテゴリ（出雲の母 好晃）:**\n- ID 131: ameba_banner (640x500) - バナー画像\n- ID 132: ameba_portrait (100x100) - 小さいポートレート ※サイズ不足\n- ID 133: ura9_portrait (750x422) - ポートレート\n- ID 134: gal_hero (640x920) - ヒーロー画像\n- ID 135: gal_portrait (640x395) - ポートレート\n- ID 136: harura_hero (640x775) - ヒーロー画像\n- ID 137: izumo_enmusubi (640x1295) - 縁結びテーマ\n- ID 138: izumo_hero (640x960) - 出雲ヒーロー\n- ID 139: izumo_key (640x340) - キービジュアル\n- ID 140: izumo_mystical (640x1420) - 神秘的テーマ\n- ID 141: izumo_portrait (640x540) - ポートレート\n- ID 142: izumo_psychic (636x328) - サイキックテーマ\n- ID 143: izumo_shrine (640x630) - 神社テーマ\n- ID 144: izumo_speaking (640x806) - スピーキング\n\n**collection カテゴリ（Pinterest収集）:**\n- ID 84-130: Pinterest経由で収集した画像群（divine golden light, spiritual ceremony, ethereal glow等のテーマ）\n\n## コマ別リファレンス選定方針\n\n| コマ | テーマ | 推奨する既存ID | 追加収集キーワード |\n|------|--------|---------------|------------------|\n| A | 神社・占い師の祈り | 84,85,138,141,143 | 出雲大社 内部, 巫女 祈り |\n| B | 手・赤い糸の分岐 | 131,137,140 | red thread fate hand, 赤い糸 薬指 |\n| C | 宇宙的拡散 | 140 | cosmic threads abstract, sacred geometry red |\n| D | 縁結び・温光 | 131,137,144 | destiny bond hand glow, 縁結び 光 |\n\n## 作業手順\n\n### Step 1: 既存リファレンスの確認と選定\n\nAPIで全リファレンスの詳細を確認:\n```bash\ncurl -s \"http://localhost:5560/api/references?limit=200\" -H \"x-api-token: makeimg_dev_token\"\n```\n\n各コマに最適な5-8枚を選定。選定基準:\n- テーマとの関連性\n- 画像サイズ（最低300x300以上を推奨、100x100等は除外）\n- カテゴリとタグの一致度\n\n### Step 2: 追加リファレンスが必要なコマの収集\n\n特にコマC（宇宙・拡散）は既存リファレンスが少ない。Collection APIで追加収集:\n\n```bash\n# 1. 収集ジョブ作成\ncurl -s -X POST http://localhost:5560/api/collection/jobs \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-token: makeimg_dev_token\" \\\n  -d '{\"query_text\":\"cosmic red threads abstract sacred geometry fate\"}'\n\n# 2. クエリ展開（LLMで関連キーワード生成）\ncurl -s -X POST http://localhost:5560/api/collection/jobs/{id}/expand \\\n  -H \"x-api-token: makeimg_dev_token\"\n\n# 3. 検索実行\ncurl -s -X POST http://localhost:5560/api/collection/jobs/{id}/search \\\n  -H \"x-api-token: makeimg_dev_token\"\n\n# 4. 候補確認\ncurl -s http://localhost:5560/api/collection/jobs/{id} \\\n  -H \"x-api-token: makeimg_dev_token\"\n\n# 5. 候補を選択\ncurl -s -X PUT http://localhost:5560/api/collection/candidates/{candidate_id}/select \\\n  -H \"x-api-token: makeimg_dev_token\"\n\n# 6. ダウンロード\ncurl -s -X POST http://localhost:5560/api/collection/jobs/{id}/download \\\n  -H \"x-api-token: makeimg_dev_token\"\n\n# 7. 重複除去\ncurl -s -X POST http://localhost:5560/api/collection/jobs/{id}/dedup \\\n  -H \"x-api-token: makeimg_dev_token\"\n```\n\n### Step 3: 最終リファレンスセット確定\n\n各コマの最終リファレンスIDリストを確定。\n\n## 出力形式\n\n以下のJSON形式でリーダーに報告:\n```json\n{\n  \"koma_a\": {\"reference_ids\": [84, 85, 138, 141, 143, ...], \"theme\": \"神社・占い師\", \"notes\": \"...\"},\n  \"koma_b\": {\"reference_ids\": [...], \"theme\": \"手・赤い糸\", \"notes\": \"...\"},\n  \"koma_c\": {\"reference_ids\": [...], \"theme\": \"宇宙・拡散\", \"notes\": \"...\"},\n  \"koma_d\": {\"reference_ids\": [...], \"theme\": \"縁結び・温光\", \"notes\": \"...\"}\n}\n```\n\n**注意:** Gemini APIはリファレンス最大14枚まで対応。各コマ5-8枚が理想。",
      "color": "green",
      "planModeRequired": false,
      "joinedAt": 1771422928098,
      "tmuxPaneId": "in-process",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": [],
      "backendType": "in-process"
    },
    {
      "agentId": "generator@img-quality-boost",
      "name": "generator",
      "agentType": "general-purpose",
      "model": "claude-opus-4-6",
      "prompt": "あなたは画像生成実行エージェントです。最適化されたプロンプトとコマ別リファレンスで48枚の画像を生成してください。\n\n## 生成計画\n\n12のプロンプトテンプレート（APIに登録済み）× 4枚 = 48枚を生成します。\n\n### プロンプトテンプレートID一覧\n\n| ID | Name | Category |\n|----|------|----------|\n| 1 | komaA_v1_dramatic | koma_a |\n| 2 | komaA_v2_intimate | koma_a |\n| 3 | komaA_v3_epic | koma_a |\n| 4 | komaB_v1_dramatic | koma_b |\n| 5 | komaB_v2_intimate | koma_b |\n| 6 | komaB_v3_epic | koma_b |\n| 7 | komaC_v1_dramatic | koma_c |\n| 8 | komaC_v2_intimate | koma_c |\n| 9 | komaC_v3_epic | koma_c |\n| 10 | komaD_v1_dramatic | koma_d |\n| 11 | komaD_v2_intimate | koma_d |\n| 12 | komaD_v3_epic | koma_d |\n\n### コマ別リファレンスID\n\n```json\n{\n  \"koma_a\": [84, 85, 138, 141, 143, 86, 93, 116],\n  \"koma_b\": [137, 140, 117, 118, 122, 123, 94, 98],\n  \"koma_c\": [145, 147, 148, 149, 150, 151, 153, 154],\n  \"koma_d\": [131, 137, 144, 100, 101, 105, 124, 129]\n}\n```\n\n## 生成手順\n\n### Step 1: 各プロンプトテンプレートの内容を取得\n```bash\ncurl -s \"http://localhost:5560/api/prompts/{id}\" -H \"x-api-token: makeimg_dev_token\"\n```\n\n### Step 2: 画像生成API呼び出し\n\n各テンプレートについて以下のAPIを実行:\n\n```bash\ncurl -s -X POST http://localhost:5560/api/generation \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-api-token: makeimg_dev_token\" \\\n  -d '{\n    \"prompt_text\": \"...(テンプレートから取得したprompt_text)\",\n    \"model\": \"gemini-3-pro-image-preview\",\n    \"aspect_ratio\": \"9:16\",\n    \"number_of_images\": 4,\n    \"reference_image_ids\": [...(コマ別リファレンスID)],\n    \"image_size\": \"2K\",\n    \"prompt_template_id\": ...(テンプレートID),\n    \"enhance_prompt\": false\n  }'\n```\n\n### 実行順序と待機\n\n**重要:** Gemini APIにはレート制限があるため、各リクエスト間に**10秒の待機**を入れてください。\n\n```\nsleep 10\n```\n\n生成順序:\n1. コマA: テンプレートID 1, 2, 3 → reference_image_ids: [84, 85, 138, 141, 143, 86, 93, 116]\n2. コマB: テンプレートID 4, 5, 6 → reference_image_ids: [137, 140, 117, 118, 122, 123, 94, 98]\n3. コマC: テンプレートID 7, 8, 9 → reference_image_ids: [145, 147, 148, 149, 150, 151, 153, 154]\n4. コマD: テンプレートID 10, 11, 12 → reference_image_ids: [131, 137, 144, 100, 101, 105, 124, 129]\n\n### Step 3: 結果の確認\n\n各セッションのレスポンスからsession_idとimage_idsを記録。生成後に確認:\n```bash\ncurl -s \"http://localhost:5560/api/generation/sessions/{session_id}\" -H \"x-api-token: makeimg_dev_token\"\n```\n\n### エラーハンドリング\n\n- 生成が失敗した場合（status: \"failed\"）、20秒待ってからリトライ\n- 3回連続失敗したら、そのテンプレートをスキップして次に進む\n- APIが429（レート制限）を返した場合、60秒待ってからリトライ\n\n## 出力\n\n完了後、以下の形式でリーダーに報告してください:\n\n```\n生成結果サマリー:\n- コマA: Session IDs [X, Y, Z], 合計N枚生成\n- コマB: Session IDs [X, Y, Z], 合計N枚生成\n- コマC: Session IDs [X, Y, Z], 合計N枚生成\n- コマD: Session IDs [X, Y, Z], 合計N枚生成\n- 総計: M枚生成完了\n- 失敗: K件（理由: ...）\n```",
      "color": "yellow",
      "planModeRequired": false,
      "joinedAt": 1771423723316,
      "tmuxPaneId": "in-process",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": [],
      "backendType": "in-process"
    }
  ]
}