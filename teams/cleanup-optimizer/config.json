{
  "name": "cleanup-optimizer",
  "description": "不要コード削除 + style_optimizer実装",
  "createdAt": 1771426170804,
  "leadAgentId": "team-lead@cleanup-optimizer",
  "leadSessionId": "7b2b3dfe-160e-4fdb-ab23-62dca26559ae",
  "members": [
    {
      "agentId": "team-lead@cleanup-optimizer",
      "name": "team-lead",
      "agentType": "orchestrator",
      "model": "claude-opus-4-6",
      "joinedAt": 1771426170804,
      "tmuxPaneId": "",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": []
    },
    {
      "agentId": "backend-cleaner@cleanup-optimizer",
      "name": "backend-cleaner",
      "agentType": "general-purpose",
      "model": "claude-opus-4-6",
      "prompt": "You are `backend-cleaner`, a teammate on team `cleanup-optimizer`. Your task is Task #1: Delete unused backend code and clean up references.\n\n## Working Directory\n/Users/masaaki_nagasawa/Desktop/prm/aiimg\n\n## Task\nFirst, mark task #1 as in_progress using TaskUpdate with owner \"backend-cleaner\".\n\n### Step 1: Delete unused files\nUse Bash rm to delete:\n```bash\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/services/prompt_enhancer.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/services/imagen.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/services/collector.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/services/dedup_service.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/services/llm_service.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/routers/collection.py\nrm /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/routers/analytics.py\n```\n\n### Step 2: Clean up generation.py\nRead /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/routers/generation.py, then edit:\n\n1. Remove `from backend.services import gemini_image, imagen` → `from backend.services import gemini_image`\n2. Remove `from backend.services.prompt_enhancer import enhance_prompt as enhance_prompt_service`\n3. Change `_VALID_MODELS = set(gemini_image.NANO_BANANA_MODELS + [m[\"id\"] for m in imagen.list_available_models()])` → `_VALID_MODELS = set(gemini_image.NANO_BANANA_MODELS)`\n4. Remove `enhance_prompt: bool = False` from GenerateRequest\n5. Remove entire EnhancePromptRequest and EnhancePromptResponse classes\n6. Remove entire `preview_enhance_prompt` endpoint function\n7. In generate_images: remove the `elif req.enhance_prompt:` block (lines 96-99). Keep the `if req.site_style_key:` block.\n8. Remove the imagen branch in image generation:\n   - Remove `if req.model.startswith(\"imagen\"):` and its body (lines 139-145)\n   - Keep only the gemini_image.generate_image call (make it unconditional, not in else)\n9. Remove the `if not req.model.startswith(\"imagen\") and` check in image_size validation (line 85). Make it always validate image_size.\n10. In list_models: change to `models = gemini_image.list_available_models()` only\n\n### Step 3: Clean up main.py\nRead /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/main.py, then edit:\n1. Remove `collection` and `analytics` from the import line\n2. Remove `app.include_router(analytics.router)` \n3. Remove `app.include_router(collection.router)`\n4. Remove the COLLECTION_DIR static mount block\n5. Remove `COLLECTION_DIR` from the config import line\n\n### Step 4: Clean up database.py\nRead /Users/masaaki_nagasawa/Desktop/prm/aiimg/backend/database.py, then edit:\n1. Remove the `collection_jobs` table CREATE statement\n2. Remove the `collection_candidates` table CREATE statement\n3. Remove collection-related indexes (idx_collection_candidates_job, idx_collection_candidates_hash, idx_collection_candidates_status)\n4. In init_database(), remove both ALTER TABLE blocks (collection_job_id and perceptual_hash)\n\n### Step 5: Add style_optimizations table to database.py\nAdd this table to SCHEMA_SQL (before the closing \"\"\"):\n```sql\n-- スタイル最適化履歴\nCREATE TABLE IF NOT EXISTS style_optimizations (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    site_style_id INTEGER NOT NULL,\n    optimization_type TEXT NOT NULL,\n    before_snapshot TEXT DEFAULT '{}',\n    after_snapshot TEXT DEFAULT '{}',\n    suggestions_json TEXT DEFAULT '[]',\n    weakness_analysis_json TEXT DEFAULT '{}',\n    applied INTEGER DEFAULT 0,\n    created_at TEXT DEFAULT (datetime('now')),\n    FOREIGN KEY (site_style_id) REFERENCES site_styles(id)\n);\n\nCREATE INDEX IF NOT EXISTS idx_style_optimizations_style ON style_optimizations(site_style_id);\n```\n\n## IMPORTANT\n- Read each file BEFORE editing\n- Use absolute paths\n- When done, mark task #1 as completed\n- Send a message to \"team-lead\" when complete",
      "color": "blue",
      "planModeRequired": false,
      "joinedAt": 1771426261195,
      "tmuxPaneId": "in-process",
      "cwd": "/Users/masaaki_nagasawa/Desktop/prm/aiimg",
      "subscriptions": [],
      "backendType": "in-process"
    }
  ]
}