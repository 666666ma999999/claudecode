[
  {
    "from": "backend-cleaner",
    "text": "{\"type\":\"task_assignment\",\"taskId\":\"1\",\"subject\":\"Backend: 不要コード削除 + generation.py/main.py/database.pyクリーンアップ\",\"description\":\"## Goal\\nスタイル一致度PDCAループに不要なバックエンドコードを削除し、残るコードの参照を修正する。\\n\\n## 削除対象ファイル\\n- backend/services/prompt_enhancer.py (旧静的プロンプト強化 → style_prompt_enhancer.pyで置換済み)\\n- backend/services/imagen.py (Imagenモデル → Geminiのみ使用)\\n- backend/services/collector.py (Web画像収集)\\n- backend/services/dedup_service.py (画像重複検出)\\n- backend/services/llm_service.py (検索クエリ拡張 → style用LLMで不要)\\n- backend/routers/collection.py (収集APIルーター)\\n- backend/routers/analytics.py (汎用分析 → style_reportで置換)\\n\\n## 修正対象\\n\\n### backend/routers/generation.py\\n- `from backend.services import gemini_image, imagen` → `from backend.services import gemini_image`\\n- `from backend.services.prompt_enhancer import enhance_prompt as enhance_prompt_service` → 削除\\n- `_VALID_MODELS` からimagen参照を削除: `set(gemini_image.NANO_BANANA_MODELS)`のみ\\n- `enhance_prompt` フィールドをGenerateRequestから削除\\n- EnhancePromptRequest/EnhancePromptResponse クラスを削除\\n- preview_enhance_prompt エンドポイントを削除\\n- generate_images内の `elif req.enhance_prompt:` ブロックを削除\\n- `if req.model.startswith(\\\"imagen\\\"):` 分岐を削除（Geminiのみ残す）\\n- `if not req.model.startswith(\\\"imagen\\\")` チェックを削除（常にimage_sizeバリデーション）\\n- list_models関数からimagen参照を削除\\n\\n### backend/main.py\\n- `from backend.routers import ... collection, analytics` → collection, analytics を削除\\n- `app.include_router(analytics.router)` 削除\\n- `app.include_router(collection.router)` 削除\\n- COLLECTION_DIR関連のstaticファイルマウント削除\\n- `from backend.config import ... COLLECTION_DIR` からCOLLECTION_DIR削除\\n\\n### backend/database.py\\n- SCHEMA_SQLから `collection_jobs` テーブル定義を削除\\n- SCHEMA_SQLから `collection_candidates` テーブル定義を削除\\n- collection関連インデックスを削除 (idx_collection_candidates_*)\\n- init_database()内の `ALTER TABLE reference_images ADD COLUMN collection_job_id` を削除\\n- reference_images テーブルの collection_job_id は残す（ALTER TABLEで追加しているので、テーブル定義自体は変わらない）\\n\\n## Constraints\\n- 全ファイルパスは /Users/masaaki_nagasawa/Desktop/prm/aiimg/ 配下\\n- 削除前にファイルをReadで確認\\n- Bash rmでファイル削除\",\"assignedBy\":\"backend-cleaner\",\"timestamp\":\"2026-02-18T14:51:04.926Z\"}",
    "timestamp": "2026-02-18T14:51:04.926Z",
    "color": "blue",
    "read": false
  }
]