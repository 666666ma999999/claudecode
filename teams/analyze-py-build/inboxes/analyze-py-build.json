[
  {
    "from": "team-lead",
    "text": "Please write the following content to /Users/masaaki/.claude/plans/steady-rolling-gizmo.md:\n\n# analyze.py 汎用化スクリプト 実装計画\n\n## Context\n月次ボードレポート生成パイプラインの一部として、任意の対象月を引数に取り\n8ヶ月分のトレンド分析・セグメント分析を行う汎用スクリプトを作成する。\n現状は analyze_202601.py / segment_analysis.py が202601専用ハードコード。\n`python3 analyze.py 202602` 形式で動作させることが目標。\n\n## 作成ファイル\n`/Users/masaaki/Desktop/prm/report/boradmtg/analyze.py`\n\n## 確認済みデータ構造\n\n### ファイルパターン\n`boradmtg/csv/デジコン収益分析_{YYYYMM}.xlsx`\n\n### シート・列設定\n| 月 | シート(index) | 合計列(0-indexed) | ラベル列 |\n|---|---|---|---|\n| 202506 | 1 (2枚目) | 31 (C32) | 1 (C2) |\n| 202507-202509 | 0 | 31 (C32) | 1 (C2) |\n| 202510-202511, 202601 | 0 | 32 (C33) | 2 (C3) |\n| 202512 | 1 (2枚目) | 32 (C33) | 2 (C3) |\n\n### 固定行番号（pandas 0-indexed）\n- row 4: 売上高\n- row 5: 占い師手数料\n- row 6: 決済代行手数料\n- row 7: 支払手数料\n- row 8: 広告宣伝費\n- row 9: 変動費計\n- row 10: 限界利益\n- 最終行: 営業利益（月により異なる: R91/R90/R113/R114）\n\n### セグメント一覧（22セグメント、全月共通）\n['モバイル新規', 'モバイル新規(27)_運用', 'リニューアル(27)_運用', 'リニューアル(28)候補',\n '新規_メディア(大百科)', 'よしもと大集合', 'モバイル注力', 'はやとも', '注力外',\n 'はやともヤースー', '橋本京明', 'めくる/ヤースー', 'ギャル', 'JUNO', 'Love/sLove',\n 'ISP', 'プラットフォーム', 'アプリ', '海外展開', '自社メディア', '新規_ロト', '新規_ポイント']\n\n### セグメント列位置（202506-202509: index 5-26, 202510+: index 6-27）\n\n## 実装関数構成\n\n```python\ndef get_file_config(yyyymm: str) -> dict:\n    n = int(yyyymm)\n    sheet_idx = 1 if yyyymm in (\"202506\", \"202512\") else 0\n    if n >= 202510:\n        return {\"total_col\": 32, \"label_col\": 2, \"seg_start\": 6, \"sheet_idx\": sheet_idx}\n    else:\n        return {\"total_col\": 31, \"label_col\": 1, \"seg_start\": 5, \"sheet_idx\": sheet_idx}\n\ndef get_8month_window(yyyymm: str) -> list[str]:\n    # 202602 -> [202507,...,202602]\n\ndef load_month_totals(yyyymm: str) -> dict:\n    # pandas.read_excel() で固定行から値取得\n    # keys: 売上高, 占い師手数料, 決済代行手数料, 支払手数料, 広告宣伝費, 変動費計, 限界利益, 営業利益\n\ndef load_segment_sales(yyyymm: str) -> dict:\n    # R5（売上高行）のセグメント列から各セグメント売上取得\n\ndef analyze_trends(months: list) -> pd.DataFrame:\n    # 月次トレンド分析 → analysis_{YYYYMM}.csv\n\ndef analyze_variable_costs(months: list) -> None:\n    # 変動費内訳・相関分析（コンソール出力）\n\ndef analyze_segments(months: list) -> pd.DataFrame:\n    # セグメント別売上 → segment_analysis_{YYYYMM}.csv\n\ndef main():\n    # sys.argv[1]=YYYYMM, --generate フラグ対応\n```\n\n## 出力ファイル\n1. `analysis_{YYYYMM}.csv` - 月次トレンド（売上/変動費/限界利益/営業利益/限界利益率）\n2. `segment_analysis_{YYYYMM}.csv` - セグメント別売上8ヶ月推移\n\n## 検証方法\n```bash\ncd /Users/masaaki/Desktop/prm/report/boradmtg\npython3 analyze.py 202601\n\n# 期待値（202601）:\n# 売上高: 82,483,501\n# 変動費計: 41,535,687\n# 広告宣伝費: 27,214,107\n# 真の変動費: 12,001,976\n# 広告宣伝費相関: r ≈ +0.21\n# 真の変動費相関: r ≈ +0.95\n```\n",
    "summary": "Write plan file for analyze.py",
    "timestamp": "2026-02-17T03:42:27.116Z",
    "read": false
  }
]